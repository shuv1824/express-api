# Development Dockerfile with hot-reloading and debugging support
FROM node:20-alpine

# Install additional tools for development
RUN apk add --no-cache \
    bash \
    git \
    curl \
    vim \
    make \
    g++ \
    python3

# Set working directory
WORKDIR /app

# Copy package files
COPY package*.json ./

# Install all dependencies (including devDependencies)
RUN npm ci

# Copy tsconfig for TypeScript resolution
COPY tsconfig.json ./

# Create directories for better organization
RUN mkdir -p src dist

# Expose ports
# 5000 for the app
# 9229 for Node.js debugging
EXPOSE 5000 9229

# Set development environment
ENV NODE_ENV=development

# Volume mount points (will be mounted from host)
VOLUME ["/app/src", "/app/tests"]

# Use tsx for hot-reloading in development
CMD ["npm", "run", "dev"]

# Alternative commands (can be overridden in docker-compose):
# For debugging: CMD ["node", "--inspect=0.0.0.0:9229", "-r", "tsx/cjs", "src/server.ts"]
# For testing: CMD ["npm", "test"]
# For test watching: CMD ["npm", "run", "test:watch"]
